# PIK Apartment Tracker

Система отслеживания цен на квартиры от застройщика ПИК (pik.ru).

## Возможности

- Отслеживание квартир по нескольким жилым комплексам PIK
- Фильтрация по параметрам: цена, комнаты, площадь, этаж
- История изменения цен на каждую квартиру
- Сохранение фильтров с email-уведомлениями
- Автоматическая проверка по расписанию (cron)
- Удобный установщик с пошаговой настройкой
- Защита паролем (авторизация)
- Современный дизайн в стиле PIK

## Быстрый старт

### 1. Загрузите на хостинг

```bash
git clone https://github.com/your-repo/PIK_apartment_search.git
```

Или скачайте ZIP и загрузите через FTP.

### 2. Откройте установщик

Перейдите в браузере:
```
https://ваш-сайт.ru/install.php
```

### 3. Следуйте мастеру установки

| Шаг | Описание |
|-----|----------|
| 1. Проверка | Автоматическая проверка PHP и расширений |
| 2. Настройки | Название сайта, часовой пояс, email для уведомлений |
| 3. Администратор | Создание логина и пароля для входа |
| 4. Готово | Установка завершена, инструкция по cron |

### 4. Войдите в систему

После установки откроется страница входа. Используйте созданные логин и пароль.

## Требования

- **PHP 7.4+** с расширениями:
  - PDO
  - PDO_SQLite
  - cURL
  - JSON
  - mbstring
- **Веб-сервер** (Apache/Nginx)
- **Права на запись** в директорию установки

## Использование

### Первый запуск

1. **Проекты** → Нажмите "Синхронизировать"
2. Отметьте галочками интересующие ЖК
3. **Квартиры** → Нажмите "Обновить данные с PIK"

### Поиск квартир

Используйте фильтры в боковой панели:

| Фильтр | Описание |
|--------|----------|
| Проект | Выберите конкретный ЖК или все |
| Комнаты | От студий (0) до многокомнатных |
| Цена | Диапазон в рублях |
| Площадь | Минимум/максимум м² |
| Этаж | Диапазон этажей |

### Сохранение фильтра с уведомлениями

1. Настройте нужные параметры фильтрации
2. Нажмите **"Сохранить фильтр"**
3. Укажите название (например: "2-комн до 15 млн")
4. Введите email для уведомлений
5. Система будет присылать письма о новых подходящих квартирах

### Автоматическая проверка (Cron)

Добавьте в crontab для автоматических проверок:

```bash
# Проверка каждые 6 часов
0 */6 * * * php /путь/к/сайту/cron.php >> /var/log/pik-tracker.log 2>&1

# Проверка каждый час
0 * * * * php /путь/к/сайту/cron.php >> /var/log/pik-tracker.log 2>&1

# Проверка раз в день в 9:00
0 9 * * * php /путь/к/сайту/cron.php >> /var/log/pik-tracker.log 2>&1
```

## Структура проекта

```
PIK_apartment_search/
├── install.php          # Мастер установки
├── login.php            # Страница входа
├── logout.php           # Выход из системы
├── index.php            # Главная страница (защищена)
├── config.php           # Конфигурация (создается установщиком)
├── cron.php             # Скрипт автоматической проверки
├── .htaccess            # Защита Apache
│
├── api/
│   ├── handler.php      # API обработчик запросов
│   ├── Database.php     # Работа с SQLite
│   ├── PikApi.php       # Клиент API PIK
│   ├── Auth.php         # Авторизация
│   └── Mailer.php       # Email уведомления
│
├── assets/
│   ├── css/style.css    # Стили (дизайн PIK)
│   └── js/app.js        # JavaScript приложение
│
└── data/
    ├── apartments.db    # База данных SQLite
    └── .installed       # Флаг успешной установки
```

## Настройки

### Email уведомления

В настройках можно указать:
- Email для получения уведомлений
- Интервал проверки (1, 3, 6, 12, 24 часа)

Для отправки через SMTP укажите параметры при установке.

### Смена пароля

**Настройки** → **Смена пароля** → Введите текущий и новый пароль

## API

Внутренний API (`api/handler.php`):

| Действие | Описание |
|----------|----------|
| `get_projects` | Список проектов PIK |
| `sync_projects` | Синхронизация проектов с PIK |
| `track_project` | Отметить проект для отслеживания |
| `get_apartments` | Список квартир с фильтрами |
| `fetch_apartments` | Загрузить свежие данные с PIK |
| `get_filters` | Сохраненные фильтры |
| `save_filter` | Сохранить фильтр |
| `get_stats` | Статистика |
| `change_password` | Смена пароля |

## Безопасность

- Все страницы защищены авторизацией
- Пароли хешируются (bcrypt)
- База данных недоступна из веба (.htaccess)
- Сессии с ограниченным временем жизни
- CSRF защита форм

## Решение проблем

### Установщик не открывается
- Проверьте что PHP работает на хостинге
- Проверьте права на директорию (755)

### Не загружаются проекты
- Проверьте подключение к интернету
- Нажмите "Проверить подключение к PIK API" в настройках

### Email не приходят
- Проверьте папку "Спам"
- Проверьте настройки SMTP
- Убедитесь что cron запускается

### Ошибка базы данных
- Проверьте права на запись в папку `data/` (777)
- Удалите `data/apartments.db` и перезапустите установщик

## Переустановка

Для полной переустановки:

```bash
rm data/.installed
rm data/apartments.db
rm config.php
```

Затем откройте `install.php` заново.

## Лицензия

MIT License

## Отказ от ответственности

Этот проект не связан с ГК ПИК. Используйте на свой страх и риск.
Данные получаются из публичного API pik.ru.
